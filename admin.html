<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Fake News Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #f8f9fa; }
        .container { margin-top: 30px; }
        .card { margin-bottom: 20px; }
        .btn-approve { background-color: #28a745; color: white; }
        .btn-reject { background-color: #dc3545; color: white; }
        .btn-logout { background-color: #6c757d; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center my-4">üõ† ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏•‡∏≠‡∏° (Admin)</h2>
        <button id="logoutBtn" class="btn btn-logout mb-3">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        <div class="row" id="newsContainer"></div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
                apiKey: "AIzaSyBzVMVLZLs14R2iMU_WeDxjRWuFBf-M55k",
                authDomain: "fakenewschecker-e9f1c.firebaseapp.com",
                projectId: "fakenewschecker-e9f1c",
                storageBucket: "fakenewschecker-e9f1c.firebasestorage.app",
                messagingSenderId: "1074286623021",
                appId: "1:1074286623021:web:8fce1b76c51469091dfba4",
            };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection("users").doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().role === "admin") {
                        loadPendingNews();
                    } else {
                        alert("‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ!");
                        window.location.href = "index.html";
                    }
                }).catch(error => {
                    console.error("‚ùå Error:", error);
                });
            } else {
                window.location.href = "login.html";
            }
        });

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        function loadPendingNews() {
            const newsContainer = document.getElementById("newsContainer");
            newsContainer.innerHTML = "";
            
            db.collection("pending_news").orderBy("createdAt", "desc").get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const news = doc.data();
                        newsContainer.innerHTML += `
                            <div class="col-md-4">
                                <div class="card">
                                    <img src="${news.imageUrl}" class="card-img-top" alt="News Image">
                                    <div class="card-body">
                                        <h5 class="card-title">${news.title}</h5>
                                        <p class="card-text">${news.description.substring(0, 100)}...</p>
                                        <a href="${news.url}" class="btn btn-info" target="_blank">üîó ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</a>
                                        <button class="btn btn-approve" onclick="approveNews('${doc.id}')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                        <button class="btn btn-reject" onclick="deleteNews('${doc.id}')">‚ùå ‡∏•‡∏ö</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                })
                .catch(error => console.error("‚ùå Error fetching news:", error));
        }

        // ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡πà‡∏≤‡∏ß
        function approveNews(newsId) {
            db.collection("pending_news").doc(newsId).get().then(doc => {
                if (doc.exists) {
                    const newsData = doc.data();
                    db.collection("verified_news").doc(newsId).set({
                        title: newsData.title,
                        description: newsData.description,
                        imageUrl: newsData.imageUrl,
                        url: newsData.url,
                        approved: true,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        db.collection("pending_news").doc(newsId).delete();
                        alert("‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                        loadPendingNews();
                    });
                }
            }).catch(error => console.error("‚ùå Error approving news:", error));
        }

        // ‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß
        function deleteNews(newsId) {
            if (confirm("‚ùó ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ?")) {
                db.collection("pending_news").doc(newsId).delete()
                    .then(() => {
                        alert("üóë ‡∏Ç‡πà‡∏≤‡∏ß‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");
                        loadPendingNews();
                    })
                    .catch(error => console.error("‚ùå Error deleting news:", error));
            }
        }

        // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        document.getElementById("logoutBtn").addEventListener("click", () => {
            auth.signOut().then(() => {
                alert("üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
                window.location.href = "login.html";
            });
        });
    </script>
</body>
</html>
